@model ExamVM
@{
    GetQuizVM quizVM = Model.QuizVM;
    Layout = null;
}


<link rel="stylesheet" href="~/assets/css/exam.css">
<div class="topbar">
    <div class="topgrid">
        <div class="titlebox">
            <div class="h1" id="quizName">@quizVM.Name</div>
            <div class="meta">
                <span id="startInfo">Start: @quizVM.StartTime</span>
                <span id="durationInfo">Duration: @quizVM.Duration</span>
            </div>
        </div>

        <div class="pill" title="Qalan vaxt">
            <span>⏳</span>
            <span class="timer" id="timerText">--:--</span>
            <div class="progress" aria-hidden="true">
                <div class="bar" id="timerBar"></div>
            </div>
        </div>
    </div>
</div>

<div class="wrap">

    <div class="row">
        <div class="card section">
            <div style="font-weight:900; font-size:15px;">Qaydalar</div>
            <div class="note" style="padding:10px 0 0;">
                • Single sualda 1 cavab seçirsən <br />
                • Multiple sualda birdən çox cavab seçirsən<br />
                • Vaxt bitəndə avtomatik submit olur.
            </div>
        </div>

        <div class="card section">
            <div style="font-weight:900; font-size:15px;">İmtahan statusu</div>
            <div class="kvs" style="margin-top:10px;">
                <div class="k">Choice</div><div class="v" id="choiceCount">@(quizVM.ChoiceQuestions == null ? 0 : @quizVM.ChoiceQuestions.Count)</div>
                <div class="k">Open</div><div class="v" id="openCount">@(quizVM.OpenQuestions == null ? 0 : @quizVM.OpenQuestions.Count)</div>
            </div>
        </div>
    </div>


    <form id="examForm" class="card" style="margin-top:14px;" method="post" asp-action="Post" asp-controller="QuizAnswer" asp-route-classRoomId="@Context.Request.Query["classRoomId"]"
          asp-route-quizId="@Context.Request.RouteValues["id"]">

        <input type="hidden" asp-for="QuizAnswer.QuizId" value="@Context.Request.RouteValues["id"]" id="quizIdInput" />

        <div class="section" style="padding-bottom:8px;">
            <div style="font-weight:900; font-size:16px;">Suallar</div>
            <div class="note" style="padding:8px 0 0;">Choice + Open qarışıq göstərilir.</div>
        </div>
        @{
            int indx = 0;
        }
        <div id="questionsWrap">
            @for (int i = 0; i < (quizVM.ChoiceQuestions?.Count ?? 0); i++)
            {
                var q = quizVM.ChoiceQuestions[i];

                <div class="q" data-kind="choice">
                    <div class="qhead">
                        <div style="min-width:0">
                            <div class="qtitle">@($"{indx + 1}. {q.Title}")</div>
                            <div class="qsub">
                                <span class="pts"> Point: <b>@q.Point</b></span>
                                <span class="type">Type: Choice @(q.IsMultiple ? "· Multiple" : "· Single")</span>
                            </div>
                        </div>
                    </div>


                    <input type="hidden" name="QuizAnswer.Answers[@indx].QuestionId" value="@q.Id" />
                    <input type="hidden" name="QuizAnswer.Answers[@indx].IsEvaluated" value="false" />

                    <div class="opts">
                        @for (int j = 0; j < (q.Options?.Count ?? 0); j++)
                        {
                            var opt = q.Options[j];

                            <label class="opt">
                                @if (q.IsMultiple)
                                {
                                    <input type="checkbox"
                                           name="QuizAnswer.Answers[@indx].AnswerIds"
                                           value="@opt.Id" />

                                }
                                else
                                {
                                    <input type="radio"
                                           asp-for="QuizAnswer.Answers[@indx].AnswerId"
                                           value="@opt.Id" />
                                }

                                <div><div class="v">@opt.Variant</div></div>
                            </label>
                        }
                        @{
                            indx++;
                        }
                    </div>
                </div>
            }
            @for (int i = 0; i < (quizVM.OpenQuestions?.Count ?? 0); i++)
            {
                var q = quizVM.OpenQuestions[i];

                <div class="q" data-kind="open">
                    <div class="qhead">
                        <div style="min-width:0">
                            <div class="qtitle">@($"{(quizVM.ChoiceQuestions?.Count ?? 0) + i + 1}. {q.Title}")</div>
                            <div class="qsub">
                                <span class="pts">Point: <b>@q.Point</b></span>
                                <span class="type">Type: Open</span>
                            </div>
                        </div>
                    </div>

                    <input type="hidden" name="QuizAnswer.Answers[@indx].QuestionId" value="@q.Id" />

                    <div style="height:12px"></div>
                    <textarea name="QuizAnswer.Answers[@indx].AnswerText" placeholder="Cavabı yaz..."></textarea>
                </div>
                indx++;                
            }
        </div>

        <div class="actions">
            <button class="btn primary" type="submit" id="btnSubmit">Submit</button>
        </div>
    </form>

</div>

<script src="~/assets/js/exam.js"></script>
