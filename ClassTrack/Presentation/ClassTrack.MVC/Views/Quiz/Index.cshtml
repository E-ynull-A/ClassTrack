@model GetQuizItemWithPermissionVM

<link rel="stylesheet" href="~/assets/css/quiz-list.css">

<div class="topbar">

    <div class="nav quiz-toolbar">
        <div>
            <a class="btn" asp-controller="Class" asp-action="ClassRoom" asp-route-id="@Context.GetRouteValue("id")">-->Class</a>
        </div>

        <div class="field-inline">
            <span class="muted">Search</span>
            <input class="input" id="qSearch" placeholder="Məs: TCP Basics" />
        </div>
    </div>
</div>

<div class="card" style="margin-top:16px;width:800px">
    <div class="h2">Quiz list</div>
    <div class="line"></div>

    <div class="quiz-grid" id="quizGrid">
        @foreach (GetQuizItemVM quiz in Model.ItemVM.QuizItems)
        {
            <div class="quiz-card">
                <a href="quiz-detail.html">
                    <div class="qc-top">
                        <div class="qc-name">@quiz.Name</div>
                    </div>

                    <div class="qc-meta">
                        <div class="qc-row">
                            <span class="muted">Start</span>
                            <strong class="qc-start" data-start="@quiz.StartTime">@quiz.StartTime</strong>
                        </div>
                        <div class="qc-row">
                            <span class="muted">Duration</span>
                            <strong class="qc-duration" data-min="@quiz.Duration">@quiz.Duration Min</strong>
                        </div>
                    </div>
                </a>
                <div class="qc-actions">
                    @if (Model.IsTeacherVM.IsTeacher)
                    {
                        @if (quiz.StartTime.ToUniversalTime() < DateTime.UtcNow && quiz.StartTime.Add(quiz.Duration).ToUniversalTime() > DateTime.UtcNow)
                        {
                            <a class="btn danger text-muted" style="text-align:center;pointer-events: none; cursor: default;">
                                <i class="fas fa-edit"></i> Quiz Begin
                            </a>
                        }
                        else if (quiz.StartTime.Add(quiz.Duration).ToUniversalTime() < DateTime.UtcNow)
                        {
                            <a class="btn ok" asp-controller="Member"
                               asp-action="GetStudent"
                               asp-route-classRoomId="@Context.GetRouteValue("id")"
                               asp-route-quizId="@quiz.Id">
                                Evaulate
                            </a>
                        }
                        else
                        {
                            <a class="btn ok" asp-action="Update"
                               asp-route-id="@quiz.Id"
                               asp-route-classRoomId="@Context.GetRouteValue("id")">
                                Edit
                            </a>
                        }

                    }
                    else
                    {
                        @if (quiz.StartTime.Add(quiz.Duration).ToUniversalTime() < DateTime.UtcNow)
                        {
                            <a class="btn danger text-muted" style="text-align:center;pointer-events: none; cursor: default;">
                                <i class="fas fa-edit"></i> Quiz is Over
                            </a>
                        }

                        else if (quiz.StartTime.ToUniversalTime() < DateTime.UtcNow && quiz.StartTime.Add(quiz.Duration).ToUniversalTime() > DateTime.UtcNow)
                        {
                            <a class="btn ok" asp-action="Get"
                               asp-route-id="@quiz.Id"
                               asp-route-classRoomId="@Context.GetRouteValue("id")">
                                Enter
                            </a>
                        }
                        else
                        {
                            var diff = quiz.StartTime.ToUniversalTime().Date - DateTime.UtcNow.Date;
                          
                            <a class="btn danger text-muted" style="text-align:center;pointer-events: none; cursor: default;">
                                <i class="fas fa-edit"></i> Left: @(diff.Days < 1 ? $"{diff.Hours} Hour" : $"{diff.Days} Day")
                            </a>
                        }
                    }
                </div>
            </div>
        }

    </div>
    @if ((int)Math.Ceiling(Model.ItemVM.TotalCount / (double)ViewBag.PageSize) > 1)
    {
        <div class="pagination-container" style="margin: 20px 0; display: flex; justify-content: center; gap: 8px;">

            @if (ViewBag.CurrentPage > 1)
            {
                <a href="?page=@(ViewBag.CurrentPage - 1)" class="pg-btn">Geri</a>
            }

            @for (int i = 1; i <= (int)Math.Ceiling(Model.ItemVM.TotalCount / (double)ViewBag.PageSize); i++)
            {
                <a href="?page=@i" class="pg-btn @(i == ViewBag.CurrentPage ? "pg-active" : "")">@i</a>
            }

            @if (ViewBag.CurrentPage < (int)Math.Ceiling(Model.ItemVM.TotalCount / (double)ViewBag.PageSize))
            {
                <a href="?page=@(ViewBag.CurrentPage + 1)" class="pg-btn">İrəli</a>
            }
        </div>
    }

    <div class="empty" id="qEmpty" style="display:none;">
        Heç bir quiz tapılmadı.
    </div>
</div>
<script src="~/assets/js/quiz-list.js"></script>


